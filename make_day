#!/bin/zsh

# Check if an argument is supplied
if [ -z "$1" ]; then
  echo "Usage: make_day <year> <day>"
  exit 1
fi

# Set variables
year="$1"
day="$2"
dir_name="$year/day$day"
url="https://adventofcode.com/$year/day/$day/input"
cookie_file="$HOME/.aoc_session"

cpp_template='
#include "../../util.hpp"

int main() {
    auto lines = readInput("input_small.txt");
    //auto lines = readInput("input.txt");   

    for (auto& line : lines){
        printf("%s\\n", line.c_str());
    }

    return 0;
}
'

# Create the directory
mkdir -p "$dir_name"
echo "Directory '$dir_name' created successfully."

# Check if session cookie file exists
if [ ! -f "$cookie_file" ]; then
  echo "Session cookie file not found at $cookie_file."
  echo "Please create a file named '.aoc_session' in your home directory with your Advent of Code session cookie."
  exit 1
fi

# Fetch the input file
echo "Fetching input file from Advent of Code..."
curl -s -H "Cookie: session=$(cat $cookie_file)" "$url" -o "$dir_name/input.txt"

# Check if the fetch was successful
if [ $? -eq 0 ] && [ -s "$dir_name/input.txt" ]; then
  echo "Input file saved to '$dir_name/input.txt'."
else
  echo "Failed to fetch the input file. Please check your session cookie and the day number."
  rm -f "$dir_name/input.txt"  # Remove the empty input file
fi

touch "$dir_name/input_small.txt"
echo "$cpp_template" > "$dir_name/part1.cpp"
echo "$cpp_template" > "$dir_name/part2.cpp"
echo "Files 'part1.cpp' and 'part2.cpp' created in '$dir_name'."

echo "Adding files to Git, committing, and pushing..."
git add "$dir_name/part1.cpp" "$dir_name/part2.cpp"
git commit -m "Made day $day"
git push
echo "Git commit and push completed successfully."

cd "$dir_name/"
code part1.cpp